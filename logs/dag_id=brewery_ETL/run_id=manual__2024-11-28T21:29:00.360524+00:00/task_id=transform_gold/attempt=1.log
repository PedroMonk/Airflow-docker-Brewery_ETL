[2024-11-28T21:33:21.484+0000] {local_task_job_runner.py:123} INFO - ::group::Pre task execution logs
[2024-11-28T21:33:21.497+0000] {taskinstance.py:2613} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: brewery_ETL.transform_gold manual__2024-11-28T21:29:00.360524+00:00 [queued]>
[2024-11-28T21:33:21.506+0000] {taskinstance.py:2613} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: brewery_ETL.transform_gold manual__2024-11-28T21:29:00.360524+00:00 [queued]>
[2024-11-28T21:33:21.506+0000] {taskinstance.py:2866} INFO - Starting attempt 1 of 2
[2024-11-28T21:33:21.517+0000] {taskinstance.py:2889} INFO - Executing <Task(PythonOperator): transform_gold> on 2024-11-28 21:29:00.360524+00:00
[2024-11-28T21:33:21.523+0000] {standard_task_runner.py:72} INFO - Started process 1458 to run task
[2024-11-28T21:33:21.526+0000] {standard_task_runner.py:104} INFO - Running: ['***', 'tasks', 'run', 'brewery_ETL', 'transform_gold', 'manual__2024-11-28T21:29:00.360524+00:00', '--job-id', '213', '--raw', '--subdir', 'DAGS_FOLDER/openbrewery_dag.py', '--cfg-path', '/tmp/tmp2354q42i']
[2024-11-28T21:33:21.528+0000] {standard_task_runner.py:105} INFO - Job 213: Subtask transform_gold
[2024-11-28T21:33:21.582+0000] {task_command.py:467} INFO - Running <TaskInstance: brewery_ETL.transform_gold manual__2024-11-28T21:29:00.360524+00:00 [running]> on host 76656507ce70
[2024-11-28T21:33:21.646+0000] {taskinstance.py:3132} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='brewery_ETL' AIRFLOW_CTX_TASK_ID='transform_gold' AIRFLOW_CTX_EXECUTION_DATE='2024-11-28T21:29:00.360524+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='manual__2024-11-28T21:29:00.360524+00:00'
[2024-11-28T21:33:21.647+0000] {taskinstance.py:731} INFO - ::endgroup::
[2024-11-28T21:33:21.660+0000] {transform_gold.py:147} INFO - Iniciando a tarefa transform_gold
[2024-11-28T21:33:21.660+0000] {transform_gold.py:161} INFO - Data de execução: 2024-11-28
[2024-11-28T21:33:21.660+0000] {transform_gold.py:16} INFO - Iniciando criação da sessão Spark para transformação Gold
[2024-11-28T21:33:27.103+0000] {transform_gold.py:41} INFO - Sessão Spark criada com sucesso para transformação Gold
[2024-11-28T21:33:27.104+0000] {transform_gold.py:50} INFO - Lendo dados da camada Silver: s3a://breweris-etl-prod-sp/silver/date=2024-11-28/
[2024-11-28T21:33:30.196+0000] {transform_gold.py:94} ERROR - Erro ao ler dados da camada Silver: An error occurred while calling o47.parquet.
: java.lang.AssertionError: assertion failed: Conflicting directory structures detected. Suspicious paths:
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=knox, indiana
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=spotsylvania, virginia
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=williamsville, new york
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=gilbert, arizona
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=louisville, colorado
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=san diego, california
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=denver, colorado
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=john day, oregon
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=mariposa, california
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=saint albans, vermont
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=westlake village, california
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=killeshin, laois
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=abington, massachusetts
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=des moines, iowa
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=gary, indiana
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=mount pleasant, wisconsin
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=raleigh, north carolina
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=taylors, south carolina
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=saint paul, minnesota
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=portland, oregon
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=coraopolis, pennsylvania
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=cincinnati, ohio
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=westminister, maryland
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=kenmore, washington
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=georgetown, delaware
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=anoka, minnesota
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=assumption, illinois
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=boise, idaho
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=okolona, mississippi
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=norman, oklahoma
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=mason, ohio
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=jackson, michigan
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=bend, oregon
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=austin, texas
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=reno, nevada
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=milwaukee, wisconsin
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=mesa, arizona
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=ocracoke, north carolina
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=hammond, indiana
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=bellingham, washington
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=houston, texas
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=tucson, arizona
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=crosslake, minnesota
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=holland patent, new york
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=castle rock, colorado
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=petaluma, california

If provided paths are partition directories, please set "basePath" in the options of the data source to specify the root directory of the table. If there are multiple root directories, please load them separately and then union them.
	at scala.Predef$.assert(Predef.scala:223)
	at org.apache.spark.sql.execution.datasources.PartitioningUtils$.parsePartitions(PartitioningUtils.scala:177)
	at org.apache.spark.sql.execution.datasources.PartitioningUtils$.parsePartitions(PartitioningUtils.scala:109)
	at org.apache.spark.sql.execution.datasources.PartitioningAwareFileIndex.inferPartitioning(PartitioningAwareFileIndex.scala:201)
	at org.apache.spark.sql.execution.datasources.InMemoryFileIndex.partitionSpec(InMemoryFileIndex.scala:75)
	at org.apache.spark.sql.execution.datasources.PartitioningAwareFileIndex.partitionSchema(PartitioningAwareFileIndex.scala:51)
	at org.apache.spark.sql.execution.datasources.DataSource.getOrInferFileFormatSchema(DataSource.scala:167)
	at org.apache.spark.sql.execution.datasources.DataSource.resolveRelation(DataSource.scala:407)
	at org.apache.spark.sql.DataFrameReader.loadV1Source(DataFrameReader.scala:229)
	at org.apache.spark.sql.DataFrameReader.$anonfun$load$2(DataFrameReader.scala:211)
	at scala.Option.getOrElse(Option.scala:189)
	at org.apache.spark.sql.DataFrameReader.load(DataFrameReader.scala:211)
	at org.apache.spark.sql.DataFrameReader.parquet(DataFrameReader.scala:563)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)
	at py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:374)
	at py4j.Gateway.invoke(Gateway.java:282)
	at py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)
	at py4j.commands.CallCommand.execute(CallCommand.java:79)
	at py4j.ClientServerConnection.waitForCommands(ClientServerConnection.java:182)
	at py4j.ClientServerConnection.run(ClientServerConnection.java:106)
	at java.base/java.lang.Thread.run(Thread.java:840)

[2024-11-28T21:33:30.197+0000] {transform_gold.py:177} ERROR - Erro na tarefa transform_gold: An error occurred while calling o47.parquet.
: java.lang.AssertionError: assertion failed: Conflicting directory structures detected. Suspicious paths:
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=knox, indiana
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=spotsylvania, virginia
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=williamsville, new york
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=gilbert, arizona
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=louisville, colorado
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=san diego, california
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=denver, colorado
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=john day, oregon
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=mariposa, california
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=saint albans, vermont
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=westlake village, california
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=killeshin, laois
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=abington, massachusetts
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=des moines, iowa
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=gary, indiana
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=mount pleasant, wisconsin
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=raleigh, north carolina
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=taylors, south carolina
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=saint paul, minnesota
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=portland, oregon
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=coraopolis, pennsylvania
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=cincinnati, ohio
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=westminister, maryland
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=kenmore, washington
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=georgetown, delaware
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=anoka, minnesota
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=assumption, illinois
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=boise, idaho
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=okolona, mississippi
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=norman, oklahoma
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=mason, ohio
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=jackson, michigan
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=bend, oregon
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=austin, texas
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=reno, nevada
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=milwaukee, wisconsin
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=mesa, arizona
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=ocracoke, north carolina
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=hammond, indiana
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=bellingham, washington
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=houston, texas
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=tucson, arizona
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=crosslake, minnesota
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=holland patent, new york
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=castle rock, colorado
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=petaluma, california

If provided paths are partition directories, please set "basePath" in the options of the data source to specify the root directory of the table. If there are multiple root directories, please load them separately and then union them.
	at scala.Predef$.assert(Predef.scala:223)
	at org.apache.spark.sql.execution.datasources.PartitioningUtils$.parsePartitions(PartitioningUtils.scala:177)
	at org.apache.spark.sql.execution.datasources.PartitioningUtils$.parsePartitions(PartitioningUtils.scala:109)
	at org.apache.spark.sql.execution.datasources.PartitioningAwareFileIndex.inferPartitioning(PartitioningAwareFileIndex.scala:201)
	at org.apache.spark.sql.execution.datasources.InMemoryFileIndex.partitionSpec(InMemoryFileIndex.scala:75)
	at org.apache.spark.sql.execution.datasources.PartitioningAwareFileIndex.partitionSchema(PartitioningAwareFileIndex.scala:51)
	at org.apache.spark.sql.execution.datasources.DataSource.getOrInferFileFormatSchema(DataSource.scala:167)
	at org.apache.spark.sql.execution.datasources.DataSource.resolveRelation(DataSource.scala:407)
	at org.apache.spark.sql.DataFrameReader.loadV1Source(DataFrameReader.scala:229)
	at org.apache.spark.sql.DataFrameReader.$anonfun$load$2(DataFrameReader.scala:211)
	at scala.Option.getOrElse(Option.scala:189)
	at org.apache.spark.sql.DataFrameReader.load(DataFrameReader.scala:211)
	at org.apache.spark.sql.DataFrameReader.parquet(DataFrameReader.scala:563)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)
	at py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:374)
	at py4j.Gateway.invoke(Gateway.java:282)
	at py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)
	at py4j.commands.CallCommand.execute(CallCommand.java:79)
	at py4j.ClientServerConnection.waitForCommands(ClientServerConnection.java:182)
	at py4j.ClientServerConnection.run(ClientServerConnection.java:106)
	at java.base/java.lang.Thread.run(Thread.java:840)

[2024-11-28T21:33:30.475+0000] {transform_gold.py:182} INFO - Sessão Spark finalizada para a tarefa transform_gold
[2024-11-28T21:33:30.476+0000] {taskinstance.py:3311} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/models/taskinstance.py", line 767, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/models/taskinstance.py", line 733, in _execute_callable
    return ExecutionCallableRunner(
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/utils/operator_helpers.py", line 252, in run
    return self.func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/models/baseoperator.py", line 417, in wrapper
    return func(self, *args, **kwargs)
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/operators/python.py", line 238, in execute
    return_value = self.execute_callable()
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/operators/python.py", line 256, in execute_callable
    return runner.run(*self.op_args, **self.op_kwargs)
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/utils/operator_helpers.py", line 252, in run
    return self.func(*args, **kwargs)
  File "/opt/airflow/scripts/transform_gold.py", line 167, in transform_gold
    df_silver = read_silver_data(spark, s3_bucket, s3_silver_path, execution_date)
  File "/opt/airflow/scripts/transform_gold.py", line 72, in read_silver_data
    df_silver = spark.read.schema(schema).parquet(f"s3a://{s3_bucket}/{s3_silver_path}/date={execution_date}/*")
  File "/home/airflow/.local/lib/python3.9/site-packages/pyspark/sql/readwriter.py", line 531, in parquet
    return self._df(self._jreader.parquet(_to_seq(self._spark._sc, paths)))
  File "/home/airflow/.local/lib/python3.9/site-packages/py4j/java_gateway.py", line 1322, in __call__
    return_value = get_return_value(
  File "/home/airflow/.local/lib/python3.9/site-packages/pyspark/errors/exceptions/captured.py", line 169, in deco
    return f(*a, **kw)
  File "/home/airflow/.local/lib/python3.9/site-packages/py4j/protocol.py", line 326, in get_return_value
    raise Py4JJavaError(
py4j.protocol.Py4JJavaError: An error occurred while calling o47.parquet.
: java.lang.AssertionError: assertion failed: Conflicting directory structures detected. Suspicious paths:
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=knox, indiana
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=spotsylvania, virginia
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=williamsville, new york
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=gilbert, arizona
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=louisville, colorado
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=san diego, california
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=denver, colorado
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=john day, oregon
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=mariposa, california
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=saint albans, vermont
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=westlake village, california
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=killeshin, laois
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=abington, massachusetts
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=des moines, iowa
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=gary, indiana
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=mount pleasant, wisconsin
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=raleigh, north carolina
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=taylors, south carolina
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=saint paul, minnesota
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=portland, oregon
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=coraopolis, pennsylvania
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=cincinnati, ohio
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=westminister, maryland
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=kenmore, washington
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=georgetown, delaware
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=anoka, minnesota
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=assumption, illinois
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=boise, idaho
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=okolona, mississippi
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=norman, oklahoma
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=mason, ohio
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=jackson, michigan
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=bend, oregon
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=austin, texas
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=reno, nevada
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=milwaukee, wisconsin
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=mesa, arizona
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=ocracoke, north carolina
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=hammond, indiana
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=bellingham, washington
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=houston, texas
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=tucson, arizona
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=crosslake, minnesota
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=holland patent, new york
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=castle rock, colorado
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=petaluma, california

If provided paths are partition directories, please set "basePath" in the options of the data source to specify the root directory of the table. If there are multiple root directories, please load them separately and then union them.
	at scala.Predef$.assert(Predef.scala:223)
	at org.apache.spark.sql.execution.datasources.PartitioningUtils$.parsePartitions(PartitioningUtils.scala:177)
	at org.apache.spark.sql.execution.datasources.PartitioningUtils$.parsePartitions(PartitioningUtils.scala:109)
	at org.apache.spark.sql.execution.datasources.PartitioningAwareFileIndex.inferPartitioning(PartitioningAwareFileIndex.scala:201)
	at org.apache.spark.sql.execution.datasources.InMemoryFileIndex.partitionSpec(InMemoryFileIndex.scala:75)
	at org.apache.spark.sql.execution.datasources.PartitioningAwareFileIndex.partitionSchema(PartitioningAwareFileIndex.scala:51)
	at org.apache.spark.sql.execution.datasources.DataSource.getOrInferFileFormatSchema(DataSource.scala:167)
	at org.apache.spark.sql.execution.datasources.DataSource.resolveRelation(DataSource.scala:407)
	at org.apache.spark.sql.DataFrameReader.loadV1Source(DataFrameReader.scala:229)
	at org.apache.spark.sql.DataFrameReader.$anonfun$load$2(DataFrameReader.scala:211)
	at scala.Option.getOrElse(Option.scala:189)
	at org.apache.spark.sql.DataFrameReader.load(DataFrameReader.scala:211)
	at org.apache.spark.sql.DataFrameReader.parquet(DataFrameReader.scala:563)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)
	at py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:374)
	at py4j.Gateway.invoke(Gateway.java:282)
	at py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)
	at py4j.commands.CallCommand.execute(CallCommand.java:79)
	at py4j.ClientServerConnection.waitForCommands(ClientServerConnection.java:182)
	at py4j.ClientServerConnection.run(ClientServerConnection.java:106)
	at java.base/java.lang.Thread.run(Thread.java:840)

[2024-11-28T21:33:30.494+0000] {taskinstance.py:1225} INFO - Marking task as UP_FOR_RETRY. dag_id=brewery_ETL, task_id=transform_gold, run_id=manual__2024-11-28T21:29:00.360524+00:00, execution_date=20241128T212900, start_date=20241128T213321, end_date=20241128T213330
[2024-11-28T21:33:30.509+0000] {taskinstance.py:340} INFO - ::group::Post task execution logs
[2024-11-28T21:33:30.510+0000] {standard_task_runner.py:124} ERROR - Failed to execute job 213 for task transform_gold (An error occurred while calling o47.parquet.
: java.lang.AssertionError: assertion failed: Conflicting directory structures detected. Suspicious paths:
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=knox, indiana
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=spotsylvania, virginia
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=williamsville, new york
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=gilbert, arizona
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=louisville, colorado
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=san diego, california
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=denver, colorado
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=john day, oregon
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=mariposa, california
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=saint albans, vermont
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=westlake village, california
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=killeshin, laois
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=abington, massachusetts
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=des moines, iowa
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=gary, indiana
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=mount pleasant, wisconsin
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=raleigh, north carolina
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=taylors, south carolina
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=saint paul, minnesota
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=portland, oregon
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=coraopolis, pennsylvania
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=cincinnati, ohio
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=westminister, maryland
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=kenmore, washington
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=georgetown, delaware
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=anoka, minnesota
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=assumption, illinois
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=boise, idaho
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=okolona, mississippi
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=norman, oklahoma
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=mason, ohio
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=jackson, michigan
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=bend, oregon
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=austin, texas
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=reno, nevada
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=milwaukee, wisconsin
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=mesa, arizona
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=ocracoke, north carolina
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=hammond, indiana
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=bellingham, washington
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=houston, texas
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=tucson, arizona
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=crosslake, minnesota
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=holland patent, new york
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=castle rock, colorado
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=petaluma, california

If provided paths are partition directories, please set "basePath" in the options of the data source to specify the root directory of the table. If there are multiple root directories, please load them separately and then union them.
	at scala.Predef$.assert(Predef.scala:223)
	at org.apache.spark.sql.execution.datasources.PartitioningUtils$.parsePartitions(PartitioningUtils.scala:177)
	at org.apache.spark.sql.execution.datasources.PartitioningUtils$.parsePartitions(PartitioningUtils.scala:109)
	at org.apache.spark.sql.execution.datasources.PartitioningAwareFileIndex.inferPartitioning(PartitioningAwareFileIndex.scala:201)
	at org.apache.spark.sql.execution.datasources.InMemoryFileIndex.partitionSpec(InMemoryFileIndex.scala:75)
	at org.apache.spark.sql.execution.datasources.PartitioningAwareFileIndex.partitionSchema(PartitioningAwareFileIndex.scala:51)
	at org.apache.spark.sql.execution.datasources.DataSource.getOrInferFileFormatSchema(DataSource.scala:167)
	at org.apache.spark.sql.execution.datasources.DataSource.resolveRelation(DataSource.scala:407)
	at org.apache.spark.sql.DataFrameReader.loadV1Source(DataFrameReader.scala:229)
	at org.apache.spark.sql.DataFrameReader.$anonfun$load$2(DataFrameReader.scala:211)
	at scala.Option.getOrElse(Option.scala:189)
	at org.apache.spark.sql.DataFrameReader.load(DataFrameReader.scala:211)
	at org.apache.spark.sql.DataFrameReader.parquet(DataFrameReader.scala:563)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)
	at py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:374)
	at py4j.Gateway.invoke(Gateway.java:282)
	at py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)
	at py4j.commands.CallCommand.execute(CallCommand.java:79)
	at py4j.ClientServerConnection.waitForCommands(ClientServerConnection.java:182)
	at py4j.ClientServerConnection.run(ClientServerConnection.java:106)
	at java.base/java.lang.Thread.run(Thread.java:840)
; 1458)
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/task/task_runner/standard_task_runner.py", line 117, in _start_by_fork
    ret = args.func(args, dag=self.dag)
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/cli/cli_config.py", line 49, in command
    return func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/utils/cli.py", line 116, in wrapper
    return f(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/cli/commands/task_command.py", line 483, in task_run
    task_return_code = _run_task_by_selected_method(args, _dag, ti)
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/cli/commands/task_command.py", line 256, in _run_task_by_selected_method
    return _run_raw_task(args, ti)
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/cli/commands/task_command.py", line 341, in _run_raw_task
    return ti._run_raw_task(
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/utils/session.py", line 97, in wrapper
    return func(*args, session=session, **kwargs)
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/models/taskinstance.py", line 3005, in _run_raw_task
    return _run_raw_task(
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/models/taskinstance.py", line 273, in _run_raw_task
    TaskInstance._execute_task_with_callbacks(
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/models/taskinstance.py", line 3159, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/models/taskinstance.py", line 3183, in _execute_task
    return _execute_task(self, context, task_orig)
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/models/taskinstance.py", line 767, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/models/taskinstance.py", line 733, in _execute_callable
    return ExecutionCallableRunner(
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/utils/operator_helpers.py", line 252, in run
    return self.func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/models/baseoperator.py", line 417, in wrapper
    return func(self, *args, **kwargs)
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/operators/python.py", line 238, in execute
    return_value = self.execute_callable()
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/operators/python.py", line 256, in execute_callable
    return runner.run(*self.op_args, **self.op_kwargs)
  File "/home/airflow/.local/lib/python3.9/site-packages/airflow/utils/operator_helpers.py", line 252, in run
    return self.func(*args, **kwargs)
  File "/opt/airflow/scripts/transform_gold.py", line 167, in transform_gold
    df_silver = read_silver_data(spark, s3_bucket, s3_silver_path, execution_date)
  File "/opt/airflow/scripts/transform_gold.py", line 72, in read_silver_data
    df_silver = spark.read.schema(schema).parquet(f"s3a://{s3_bucket}/{s3_silver_path}/date={execution_date}/*")
  File "/home/airflow/.local/lib/python3.9/site-packages/pyspark/sql/readwriter.py", line 531, in parquet
    return self._df(self._jreader.parquet(_to_seq(self._spark._sc, paths)))
  File "/home/airflow/.local/lib/python3.9/site-packages/py4j/java_gateway.py", line 1322, in __call__
    return_value = get_return_value(
  File "/home/airflow/.local/lib/python3.9/site-packages/pyspark/errors/exceptions/captured.py", line 169, in deco
    return f(*a, **kw)
  File "/home/airflow/.local/lib/python3.9/site-packages/py4j/protocol.py", line 326, in get_return_value
    raise Py4JJavaError(
py4j.protocol.Py4JJavaError: An error occurred while calling o47.parquet.
: java.lang.AssertionError: assertion failed: Conflicting directory structures detected. Suspicious paths:
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=knox, indiana
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=spotsylvania, virginia
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=williamsville, new york
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=gilbert, arizona
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=louisville, colorado
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=san diego, california
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=denver, colorado
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=john day, oregon
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=mariposa, california
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=saint albans, vermont
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=westlake village, california
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=killeshin, laois
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=abington, massachusetts
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=des moines, iowa
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=gary, indiana
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=mount pleasant, wisconsin
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=raleigh, north carolina
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=taylors, south carolina
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=saint paul, minnesota
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=portland, oregon
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=coraopolis, pennsylvania
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=cincinnati, ohio
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=westminister, maryland
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=kenmore, washington
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=georgetown, delaware
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=anoka, minnesota
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=assumption, illinois
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=boise, idaho
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=okolona, mississippi
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=norman, oklahoma
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=mason, ohio
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=jackson, michigan
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=bend, oregon
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=austin, texas
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=reno, nevada
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=milwaukee, wisconsin
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=mesa, arizona
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=ocracoke, north carolina
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=hammond, indiana
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=bellingham, washington
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=houston, texas
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=tucson, arizona
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=crosslake, minnesota
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=holland patent, new york
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=castle rock, colorado
	s3a://breweris-etl-prod-sp/silver/date=2024-11-28/localizacao=petaluma, california

If provided paths are partition directories, please set "basePath" in the options of the data source to specify the root directory of the table. If there are multiple root directories, please load them separately and then union them.
	at scala.Predef$.assert(Predef.scala:223)
	at org.apache.spark.sql.execution.datasources.PartitioningUtils$.parsePartitions(PartitioningUtils.scala:177)
	at org.apache.spark.sql.execution.datasources.PartitioningUtils$.parsePartitions(PartitioningUtils.scala:109)
	at org.apache.spark.sql.execution.datasources.PartitioningAwareFileIndex.inferPartitioning(PartitioningAwareFileIndex.scala:201)
	at org.apache.spark.sql.execution.datasources.InMemoryFileIndex.partitionSpec(InMemoryFileIndex.scala:75)
	at org.apache.spark.sql.execution.datasources.PartitioningAwareFileIndex.partitionSchema(PartitioningAwareFileIndex.scala:51)
	at org.apache.spark.sql.execution.datasources.DataSource.getOrInferFileFormatSchema(DataSource.scala:167)
	at org.apache.spark.sql.execution.datasources.DataSource.resolveRelation(DataSource.scala:407)
	at org.apache.spark.sql.DataFrameReader.loadV1Source(DataFrameReader.scala:229)
	at org.apache.spark.sql.DataFrameReader.$anonfun$load$2(DataFrameReader.scala:211)
	at scala.Option.getOrElse(Option.scala:189)
	at org.apache.spark.sql.DataFrameReader.load(DataFrameReader.scala:211)
	at org.apache.spark.sql.DataFrameReader.parquet(DataFrameReader.scala:563)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)
	at py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:374)
	at py4j.Gateway.invoke(Gateway.java:282)
	at py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)
	at py4j.commands.CallCommand.execute(CallCommand.java:79)
	at py4j.ClientServerConnection.waitForCommands(ClientServerConnection.java:182)
	at py4j.ClientServerConnection.run(ClientServerConnection.java:106)
	at java.base/java.lang.Thread.run(Thread.java:840)

[2024-11-28T21:33:30.548+0000] {local_task_job_runner.py:266} INFO - Task exited with return code 1
[2024-11-28T21:33:30.569+0000] {taskinstance.py:3895} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-11-28T21:33:30.571+0000] {local_task_job_runner.py:245} INFO - ::endgroup::
